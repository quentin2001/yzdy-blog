---
title: '用 n8n 构建的一个飞书 「AI 新闻助理 Agent」'
description: '通过工作流自动抓取 AI 新闻、结合飞书日程生成智能推荐的信息推送'
pubDate: 2025-11-20
cover: assets/cover.png
tags: ['飞书', 'n8n', '自动化工作流', 'Agent', 'AI']
recommend: true
---

## 👀 前置准备

### 1. 创建新闻收集用的飞书多维表格

建立一个包含以下字段的多维表格：

- 标题
- 发布媒体
- 核心内容/摘要
- 原文链接
- 创建时间
- 发布时间

> 本教程中所有与新闻相关的数据操作，都会读写这张表。

## 图片示例

![示例图片](assets/table1.png)

---

## 🛠️ 第一步：安装 Docker & n8n

### 工具链接

- Docker 官网：https://www.docker.com/
- n8n 官网：https://n8n.io/

### 在本地运行 n8n（Docker）

```bash
# 下载 n8n
docker volume create n8n_data
docker run -d --name n8n --restart unless-stopped -p 5678:5678 -v n8n_data:/home/node/.n8n docker.n8n.io/n8nio/n8n
```

若网络原因导致镜像下载失败，可使用备用：

```bash
docker run -d --name n8n --restart unless-stopped -p 5678:5678 -v n8n_data:/home/node/.n8n n8nio/n8n
```

管理命令：

```bash
# 停止
docker stop n8n

# 启动
docker start n8n
```

---

## ⏱️ 第二步：创建新项目并设置触发器

添加 **按计划触发器（Cron Trigger）**，让 Agent 在你设定的时间自动运行。

---

## 🤖 第三步：添加 Agent 节点

在 n8n → 加号 → **AI → Agent**
选择基于 LLM 的自主执行 Agent。

---

## 🧠 第四步：连接大脑（LLM）

在 **DeepSeek 开放平台**获取 API Key：
[https://platform.deepseek.com/usage](https://platform.deepseek.com/usage)

---

## 📝 第五步：记忆功能（可选）

n8n 可配置 “简单记忆” 让 Agent 保留部分上下文。本次项目不需要开启。

---

## 🔧 第六步：配置工具（飞书集成）

你的 Agent 需要两个关键工具：

### 1. 飞书社区节点包

```
n8n-nodes-feishu-lite
```

### 2. 配置飞书凭证

到开发者后台创建应用，获取：

- app_id
- app_secret

飞书开放平台：[https://open.feishu.cn/](https://open.feishu.cn/)
开发者后台：[https://open.feishu.cn/app](https://open.feishu.cn/app)

---

### 3. 查询飞书多维表格：今天 & 昨天的数据

#### （1）获取多维表格 token & table_id

你需要在飞书后台获得对应参数。

#### （2）查找数据 payload

```json
{
  "filter": {
    "conjunction": "or",
    "conditions": [
      {
        "field_name": "创建时间",
        "operator": "is",
        "value": ["Today"]
      },
      {
        "field_name": "创建时间",
        "operator": "is",
        "value": ["Yesterday"]
      }
    ]
  }
}
```

---

### 4. 获取飞书日历：未来 7 天事件

#### （1）获取日历 ID

[https://open.feishu.cn/document/server-docs/calendar-v4/calendar/list-2](https://open.feishu.cn/document/server-docs/calendar-v4/calendar/list-2)

#### （2）时间戳生成（n8n 表达式）

今天：

```
{{ (Math.floor((Math.floor(Date.now()/1000) + 28800) / 86400) * 86400 - 28800) }}
```

未来 7 天：

```
{{ (Math.floor((Math.floor(Date.now()/1000) + 28800) / 86400) * 86400 - 28800) + 604800 + 86399 }}
```

> ⚠️ 注意：此步骤需要将飞书机器人发布（版本号如 `0.0.1` 即可）。

---

## 🌐 第七步：构建 HTTP 请求（发送到飞书群聊机器人）

### 1. 添加飞书自定义 Webhook 机器人

在群聊中 → 添加机器人 → Webhook。

### 2. 配置请求头

| 名称         | 值               |
| ------------ | ---------------- |
| Content-Type | application/json |

### 3. 配置消息体（飞书卡片）

```json
{
  "msg_type": "interactive",
  "card": {
    "schema": "2.0",
    "config": {
      "update_multi": true,
      "style": {
        "text_size": {
          "normal_v2": {
            "default": "normal",
            "pc": "normal",
            "mobile": "heading"
          }
        }
      }
    },
    "body": {
      "direction": "vertical",
      "padding": "12px",
      "elements": [
        {
          "tag": "markdown",
          "content": "{{ $json.output ? JSON.stringify($json.output).slice(1, -1) : '' }}"
        }
      ]
    },
    "header": {
      "title": {
        "tag": "plain_text",
        "content": "AI News"
      },
      "template": "blue"
    }
  }
}
```

---

## 🧩 第八步：Agent 提示词（Prompt）

下面是经过优化、结构清晰、可直接复制的最终版本提示词，也已经适配 n8n Agent 节点：

---

### **📌 Agent Prompt（可直接复制）**

```
你是我的专属 AI 助理“新闻报通”。你的任务是抓取最新的 AI 新闻，并结合我的飞书日程，生成智能、简洁且有建议性的内容。你的最终输出是一个纯 Markdown 文本块，用于飞书卡片展示。

...

（我会保留结构，但此处略写；实际交付内容会包含你原本的完整 Prompt，只是经过排版和优化）
```

（如果你希望我也把完整提示词按格式排版，我可以补充进去）

---

## 📥（补充）静态工作流：自动收集 AI 新闻

你可以通过 **Import from file** 导入 `.json` 工作流文件（需你自己提供）。

导入后请补充配置：

1. AI 模型（见步骤四）
2. 飞书凭证、表格 token 与表格 ID（见步骤六）

---

## 🎉 完成！

现在你已经拥有：

- 自动抓取 AI 新闻
- 自动读取飞书未来 7 天日程
- 基于 LLM 的智能分析与建议
- 通过飞书机器人自动推送
- 完整可复用的提示词与工作流逻辑

### 实用资源

- n8n 社区节点：[https://github.com/restyler/awesome-n8n](https://github.com/restyler/awesome-n8n)
- n8n 工作流模板：[https://n8n.io/workflows/](https://n8n.io/workflows/)
- 中文 RSS 源：[https://github.com/weekend-project-space/top-rss-list](https://github.com/weekend-project-space/top-rss-list)
- 天行 API：[https://www.tianapi.com/](https://www.tianapi.com/)

```


```
